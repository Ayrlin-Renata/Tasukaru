/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package com.ayrlin.tasukaru;

import co.casterlabs.caffeinated.pluginsdk.*;
import co.casterlabs.caffeinated.pluginsdk.widgets.settings.WidgetSettingsItem;
import co.casterlabs.caffeinated.pluginsdk.widgets.settings.WidgetSettingsLayout;
import co.casterlabs.caffeinated.pluginsdk.widgets.settings.WidgetSettingsSection;
import xyz.e3ndr.fastloggingframework.logging.FastLogger;

@CaffeinatedPluginImplementation
public class Tasukaru extends CaffeinatedPlugin {
    private static Tasukaru instance = null;

    private FastLogger log;

    public Tasukaru() {
        super();
        log = this.getLogger();
        if(instance != null) {
            log.warn("THROWING EXCEPTION FOR DUPLICATE TASUKARU");
            throw new RuntimeException("use Tasukaru.instance(), DO NOT CONSTRUCT THIS A SECOND TIME :3");
        }
        instance = this;
    }

    /**
     * use this singleton dont construct another
     * @return THE ONE TASUKARU
     */
    public static Tasukaru instance() {
        if(instance == null) {
            instance = new Tasukaru();
        }
        return instance;
    }

    @Override
    public void onInit() {
        log.debug("Tasukaru onInit()");
        log.info("I'm saved :3");

        //settings applet
        this.createSettingsApplet();
        this.renderSettingsLayout();

        // database init
        VBHandler.instance().begin();

        // listener registration
        addKoiListener(TListener.instance());
    }

    
    @Override
    /**
     * triggers when user unloads the plugin, NOT on application close
     */
    public void onClose() {
        log.debug("Tasukaru onClose()");
        
        log.info("Tasukaru is leaving bye!");
    }

    @Override
    public String getName() {
        return "Tasukaru";
    }
    
    @Override
    public String getId() {
        return "com.ayrlin.tasukaru";
    }
    
    private void renderSettingsLayout() {
        WidgetSettingsLayout tLayout = new WidgetSettingsLayout();
        WidgetSettingsSection sectionPoints = new WidgetSettingsSection("points","tskr points")
                .addItem(WidgetSettingsItem.asNumber("points_message", "points per message", 0, 1, Integer.MIN_VALUE, Integer.MAX_VALUE));
        tLayout.addSection(sectionPoints);
        this.setSettingsLayout(tLayout);
    }
}